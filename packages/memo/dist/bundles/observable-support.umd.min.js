!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@aspectjs/memo"),require("rxjs"),require("rxjs/operators"),require("@aspectjs/core/annotations"),require("@aspectjs/core/commons")):"function"==typeof define&&define.amd?define(["exports","@aspectjs/memo","rxjs","rxjs/operators","@aspectjs/core/annotations","@aspectjs/core/commons"],factory):factory(((global="undefined"!=typeof globalThis?globalThis:global||self).aspectjs=global.aspectjs||{},global.aspectjs["memo_observable-support"]={}),global.aspectjs.memo,global.rxjs,global.rxjs.operators,global.aspectjs.core_annotations,global.aspectjs.core_commons)}(this,(function(exports,memo,rxjs,operators,annotations,commons){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}var ObservableMemoSupportAspect_1,ObservableMarshaller=function(_MemoMarshaller){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(ObservableMarshaller,_MemoMarshaller);var _super=_createSuper(ObservableMarshaller);function ObservableMarshaller(){var _this;return _classCallCheck(this,ObservableMarshaller),(_this=_super.apply(this,arguments)).types="Observable",_this}return _createClass(ObservableMarshaller,[{key:"marshal",value:function(frame,context,defaultMarshal){return frame.setAsyncValue(frame.value.pipe(operators.shareReplay(1)).toPromise().then((function(v){return defaultMarshal(v)}))),frame}},{key:"unmarshal",value:function(frame,context,defaultUnmarshal){return frame.isAsync()?rxjs.from(frame.async.then((function(v){return defaultUnmarshal(v)}))).pipe(operators.share()):rxjs.from(Promise.resolve(defaultUnmarshal(frame.value)))}}]),ObservableMarshaller}(memo.MemoMarshaller);function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __metadata(metadataKey,metadataValue){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}exports.ObservableMemoSupportAspect=ObservableMemoSupportAspect_1=function(){function ObservableMemoSupportAspect(){_classCallCheck(this,ObservableMemoSupportAspect)}return _createClass(ObservableMemoSupportAspect,[{key:"onEnable",value:function(weaver){var memoAspect=weaver.getAspect(memo.MemoAspect);if(!memoAspect)throw new commons.WeavingError("Cannot enable ".concat(ObservableMemoSupportAspect_1.name,": ").concat(memo.MemoAspect.name," should be enabled first"));memoAspect.addMarshaller(new ObservableMarshaller)}},{key:"onDisable",value:function(weaver){var _a;null===(_a=weaver.getAspect(memo.MemoAspect))||void 0===_a||_a.removeMarshaller(new ObservableMarshaller)}},{key:"shareReplay",value:function(ctxt){return rxjs.isObservable(ctxt.value)?ctxt.value.pipe(operators.shareReplay(1)):ctxt.value}}]),ObservableMemoSupportAspect}(),__decorate([annotations.AfterReturn(commons.on.method.withAnnotations(memo.Memo)),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],exports.ObservableMemoSupportAspect.prototype,"shareReplay",null),exports.ObservableMemoSupportAspect=ObservableMemoSupportAspect_1=__decorate([annotations.Aspect("@aspectjs/memo:ObservableMemoSupportAspect")],exports.ObservableMemoSupportAspect),exports.ObservableMarshaller=ObservableMarshaller}));
//# sourceMappingURL=observable-support.umd.min.js.map
