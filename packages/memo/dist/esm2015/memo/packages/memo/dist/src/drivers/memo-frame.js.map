{"version":3,"file":"memo-frame.js","sources":["../../../../../../../../src/drivers/memo-frame.ts"],"sourcesContent":["import { isPromise } from '@aspectjs/core/utils';\n\n/**\n * Flat dehydrated representation of an object that can be stored easily\n * @public\n */\nexport interface MemoTypeInfoFrame {\n    type?: string;\n    instanceType?: string;\n    expiration?: Date;\n    version?: string;\n}\n\n/**\n * A MemoEntry once marshalled\n * @public\n */\nexport class MemoFrame<T = unknown> implements MemoTypeInfoFrame {\n    type?: string;\n    instanceType?: string;\n    version?: string;\n    value: T;\n    hash?: string;\n    async: Promise<T>;\n    private _resolved: boolean;\n    constructor(frame: Partial<MemoFrame<T>>) {\n        Object.assign(this, frame);\n    }\n\n    setValue<X>(value: X): MemoFrame<X> {\n        this._resolved = true;\n        this.async = null;\n        const frame = (this as any) as MemoFrame<X>;\n        frame.value = value;\n        return frame;\n    }\n\n    setAsyncValue<X>(value: Promise<X>): MemoFrame<X> {\n        const frame = (this as any) as MemoFrame<X>;\n        this._resolved = false;\n        this.async = value.then((v) => {\n            frame.value = v;\n            this._resolved = true;\n            return (frame.value as any) as T;\n        });\n        return frame;\n    }\n\n    isAsync() {\n        return isPromise(this.async);\n    }\n}\n"],"names":[],"mappings":";;AAaA;;;;MAIa,SAAS;IAQlB,YAAY,KAA4B;QACpC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;KAC9B;IAED,QAAQ,CAAI,KAAQ;QAChB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,MAAM,KAAK,GAAI,IAA4B,CAAC;QAC5C,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;QACpB,OAAO,KAAK,CAAC;KAChB;IAED,aAAa,CAAI,KAAiB;QAC9B,MAAM,KAAK,GAAI,IAA4B,CAAC;QAC5C,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;YACtB,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC;YAChB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,OAAQ,KAAK,CAAC,KAAkB,CAAC;SACpC,CAAC,CAAC;QACH,OAAO,KAAK,CAAC;KAChB;IAED,OAAO;QACH,OAAO,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KAChC;;;;;"}