{"version":3,"file":"object-marshaller.js","sources":["../../../../../../../../../src/marshalling/marshallers/object-marshaller.ts"],"sourcesContent":["import { assert } from '@aspectjs/core/utils';\nimport { MemoFrame } from '../../drivers';\nimport { MarshalFn, MemoMarshaller, UnmarshalFn } from './marshaller';\nimport { MarshallingContext, UnmarshallingContext } from '../marshalling-context';\n\n/**\n * Supports marshalling simple objects\n * @public\n */\nexport class ObjectMarshaller extends MemoMarshaller {\n    readonly types = ['Object', 'object'];\n\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    marshal(frame: MemoFrame<object>, context: MarshallingContext, defaultMarshal: MarshalFn): MemoFrame<object> {\n        if (!frame.value) {\n            return frame;\n        }\n        return frame.setValue(\n            ([] as (string | symbol)[])\n                .concat(Object.getOwnPropertyNames(frame.value))\n                .concat(Object.getOwnPropertySymbols(frame.value))\n                .reduce((w, k) => {\n                    const v = (frame.value as any)[k];\n\n                    w[k] = defaultMarshal(v);\n\n                    return w;\n                }, {} as any),\n        );\n    }\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    unmarshal(frame: MemoFrame<object>, context: UnmarshallingContext, defaultUnmarshal: UnmarshalFn): object {\n        if (frame.value === null) {\n            return null;\n        }\n        const value: any = {};\n        context.blacklist.set(frame, value);\n        assert(!!frame.value);\n        return ([] as (string | symbol)[])\n            .concat(Object.getOwnPropertyNames(frame.value))\n            .concat(Object.getOwnPropertySymbols(frame.value))\n            .reduce((v, k) => {\n                v[k] = defaultUnmarshal((frame.value as any)[k]);\n                return v;\n            }, value as any);\n    }\n}\n"],"names":[],"mappings":";;;AAKA;;;;MAIa,gBAAiB,SAAQ,cAAc;IAApD;;QACa,UAAK,GAAG,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;KAoCzC;;IAjCG,OAAO,CAAC,KAAwB,EAAE,OAA2B,EAAE,cAAyB;QACpF,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE;YACd,OAAO,KAAK,CAAC;SAChB;QACD,OAAO,KAAK,CAAC,QAAQ,CAChB,EAA0B;aACtB,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;aAC/C,MAAM,CAAC,MAAM,CAAC,qBAAqB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;aACjD,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC;YACT,MAAM,CAAC,GAAI,KAAK,CAAC,KAAa,CAAC,CAAC,CAAC,CAAC;YAElC,CAAC,CAAC,CAAC,CAAC,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC;YAEzB,OAAO,CAAC,CAAC;SACZ,EAAE,EAAS,CAAC,CACpB,CAAC;KACL;;IAED,SAAS,CAAC,KAAwB,EAAE,OAA6B,EAAE,gBAA6B;QAC5F,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,EAAE;YACtB,OAAO,IAAI,CAAC;SACf;QACD,MAAM,KAAK,GAAQ,EAAE,CAAC;QACtB,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QACpC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACtB,OAAQ,EAA0B;aAC7B,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;aAC/C,MAAM,CAAC,MAAM,CAAC,qBAAqB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;aACjD,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC;YACT,CAAC,CAAC,CAAC,CAAC,GAAG,gBAAgB,CAAE,KAAK,CAAC,KAAa,CAAC,CAAC,CAAC,CAAC,CAAC;YACjD,OAAO,CAAC,CAAC;SACZ,EAAE,KAAY,CAAC,CAAC;KACxB;;;;;"}